# Default values for configuration of a STARTX cluster
# see values.yaml for explanation on each params
context: &context
  scope: startx
  cluster: hyperconverged-cluster
  environment: network
  component: kubevirt
  app: demo-kubevirt
project: 
  enabled: false
  context: 
    <<: *context
  project: 
    enabled: true
    hooked: false
    type: namespace
    name: demo-kubevirt
    display_name: "Demo KUBEVIRT"
    requester: startx
    description: Demo on Kubevirt and hyperconverged features configured by STARTX
  rbac: 
    enabled: true
    groups: 
    - id: dev-view
      name: dev
      role: view
    - id: devops-admin
      name: devops
      role: admin
    - id: ops-admin
      name: ops
      role: admin
    users: 
    - id: argocd-controller-sa
      name: system:serviceaccount:startx-argocd:argocd-application-controller
      role: edit
  networkpolicy: 
    enabled: false
    rules: []
  limits: 
    enabled: true
    rules: |
      limits:
        - type: "Pod"
          min:
            cpu: "20m"
            memory: "32Mi"
          max:
            cpu: 2
            memory: "2Gi"
        - type: "Container"
          default:
            cpu: "500m"
            memory: "512Mi"
          defaultRequest:
            cpu: "20m"
            memory: "32Mi"
          min:
            cpu: "20m"
            memory: "32Mi"
          max:
            cpu: 2
            memory: "2Gi"
        - type: "PersistentVolumeClaim"
          min:
            storage: "1Gi"
          max:
            storage: "50Gi"
        - type: "kubevirt.io/VirtualMachine"
          default:
            cpu: "500m"
            memory: "512Mi"
          defaultRequest:
            cpu: "200m"
            memory: "256Mi"
          min:
            cpu: "200m"
            memory: "256Mi"
          max:
            cpu: 4
            memory: "32Gi"
  quotas: 
    enabled: true
    rules: |
      hard:
        limits.cpu: "30"
        limits.memory: "100Gi"
        requests.cpu: "15"
        requests.memory: "60Gi"
        requests.storage: "1Ti"
        persistentvolumeclaims: "50"
        ephemeral-storage: "250Gi"
        gp2.storageclass.storage.k8s.io/requests.storage: "0Gi"
        gp2.storageclass.storage.k8s.io/persistentvolumeclaims: "0"
        gp3.storageclass.storage.k8s.io/requests.storage: "0Gi"
        gp3.storageclass.storage.k8s.io/persistentvolumeclaims: "0"
        gp2-csi.storageclass.storage.k8s.io/requests.storage: "0Gi"
        gp2-csi.storageclass.storage.k8s.io/persistentvolumeclaims: "0"
        gp3-csi.storageclass.storage.k8s.io/requests.storage: "1Ti"
        gp3-csi.storageclass.storage.k8s.io/persistentvolumeclaims: "50"
        startx-aws-generic-retain.storageclass.storage.k8s.io/requests.storage: "1Ti"
        startx-aws-generic-retain.storageclass.storage.k8s.io/persistentvolumeclaims: "50"
        startx-aws-generic-delete.storageclass.storage.k8s.io/requests.storage: "1Ti"
        startx-aws-generic-delete.storageclass.storage.k8s.io/persistentvolumeclaims: "50"
        startx-aws-fast-retain.storageclass.storage.k8s.io/requests.storage: "1Ti"
        startx-aws-fast-retain.storageclass.storage.k8s.io/persistentvolumeclaims: "50"
        startx-aws-fast-delete.storageclass.storage.k8s.io/requests.storage: "1Ti"
        startx-aws-fast-delete.storageclass.storage.k8s.io/persistentvolumeclaims: "50"
        startx-aws-slow-retain.storageclass.storage.k8s.io/requests.storage: "1Ti"
        startx-aws-slow-retain.storageclass.storage.k8s.io/persistentvolumeclaims: "50"
        startx-aws-slow-delete.storageclass.storage.k8s.io/requests.storage: "1Ti"
        startx-aws-slow-delete.storageclass.storage.k8s.io/persistentvolumeclaims: "50"
        startx-odf-generic-delete.storageclass.storage.k8s.io/requests.storage: "1Ti"
        startx-odf-generic-delete.storageclass.storage.k8s.io/persistentvolumeclaims: "50"
        startx-odf-generic-retain.storageclass.storage.k8s.io/requests.storage: "1Ti"
        startx-odf-generic-retain.storageclass.storage.k8s.io/persistentvolumeclaims: "50"
        startx-odf-fs-delete.storageclass.storage.k8s.io/requests.storage: "1Ti"
        startx-odf-fs-delete.storageclass.storage.k8s.io/persistentvolumeclaims: "50"
        startx-odf-fs-retain.storageclass.storage.k8s.io/requests.storage: "1Ti"
        startx-odf-fs-retain.storageclass.storage.k8s.io/persistentvolumeclaims: "50"
        ocs-storagecluster-ceph-rbd.storageclass.storage.k8s.io/requests.storage: "1Ti"
        ocs-storagecluster-ceph-rbd.storageclass.storage.k8s.io/persistentvolumeclaims: "50"
        openshift-storage.noobaa.io.storageclass.storage.k8s.io/requests.storage: "1Ti"
        openshift-storage.noobaa.io.storageclass.storage.k8s.io/persistentvolumeclaims: "50"
        pods: "100"
        services: "25"
        services.loadbalancers: "0"
        services.nodeports: "0"
        secrets: "50"
        configmaps: "50"
        replicationcontrollers: "5"
        openshift.io/imagestreams: "0"
        count/daemonsets.apps: "0"
        count/replicasets.apps: "5"
        count/deployments.apps: "5"
        kubevirt.io/virtualmachine: "10"

operator:
  enabled: false
  context: 
    <<: *context
  subscription:
    enabled: true
    hooked: false
    name: "kubevirt-hyperconverged"
    namespace: "openshift-cnv"
    version: "v4.12.6"
    operator: 
      channel: "stable"
      name: kubevirt-hyperconverged
      installPlanApproval: Automatic
      csv: kubevirt-hyperconverged-operator
      source: 
        name: redhat-operators
        namespace: openshift-marketplace
  operatorGroup:
    enabled: true
    hooked: false
    name: "kubevirt"
    namespace: "openshift-cnv"
    providedAPIs: "CDI.v1beta1.cdi.kubevirt.io,HostPathProvisioner.v1beta1.hostpathprovisioner.kubevirt.io,HyperConverged.v1beta1.hco.kubevirt.io,KubeVirt.v1.kubevirt.io,NetworkAddonsConfig.v1.networkaddonsoperator.network.kubevirt.io,SSP.v1beta1.ssp.kubevirt.io,TektonTasks.v1alpha1.tektontasks.kubevirt.io"
hyperconvergedCluster:
  enabled: false
  hooked: false
  name: "kubevirt-hyperconverged" 
  storageClass: "gp3-csi" 
vms:
  enabled: true
  list: 
    - name: "startx-demo-rhel8-vm"
      namespace: "demo-kubevirt"
      hostname: "startx-demo-rhel8-vm.local"
      os: 
        name: "RHEL 8"
        signature: "rhel8.0"
        image: "https://sso.redhat.com/auth/realms/redhat-external/protocol/openid-connect/auth?client_id=rh-product-eval&redirect_uri=https%3A%2F%2Fwww.redhat.com%2Fen%2Ftechnologies%2Flinux-platforms%2Fenterprise-linux%2Ftry-it%2Fsuccess-server&state=24f7a53b-3094-4f54-8fb1-7edf1347eb7b&response_mode=fragment&response_type=code&scope=openid&nonce=ccc92ec8-9b40-44a7-b6fe-7ee48eba8fd2"
      storage:
        boot_size: 15G
        boot_storageclass: startx-aws-generic-delete
        disks: 
        - name: disk0
          storageclass: startx-aws-generic-delete
          size: 10G
          boot_order: 3
      cloudInit: |
        #cloud-config
        name: rhel8
        hostname: "rhel8-vm.local"
        ssh_authorized_keys:
          - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDWDlg68Uc8j5qBA4OYfxvlMc2nSmL6cb8esoy+cPFeIstafJfza1G+Q5wiMf8QBNqWHi03hnoFaElI148thiwwd9fLIz7KQ+lSk7UQAlkZ4AH5L9B+NkUzydhccNT/xNEqO7M/JwMYDS96iyr3NnbYyiDJg+OOCO5l1ebhA2b0XzFOaNeEGbDizb7QLADg6mbcgnaLhb17nI7G90fJE1jJymX1Q/aQFQqcZrv7jA5lvxAoxHW0llTGnF8IpsOoQT9pbVZxoxUJgR9dc7uIKyZcXo6UKw9pkoA3wzsutv6aLTKaG2SwOxNDJxBx98C4XURMUr0dU5vHCTbhPNZYTZIjhPauPxyy2ud0kLUImXFlz7dnNThOfZFp0dSMAx+8s9E0dVzbjqurILsPNLKP4Zjkk13KtWh6qI6VhdiXKOTpokkAFenV5d2hwP0WwL9MOU297u3i1XpS9FdrJZgQH5M1Dp9/fwSYcwbSFbj7f3qZ3NGvaM6VqfW6o6iMPWEkKYo36P0OrkuYsgMRr4w25IUAXI00mzYzN1D7T1nkMIX4JGlemh065536/z8MeKPoFhmRVqlAykJDXEvfNef0m8DjwxnroGQmre/4ewyif0q0I7K+Aj/xjSEqO+MLuNMUXJCWi08uzM0v+YSsJkADKmJH2kWPjrA4sbsAn0c8EDPDJQ== dev@startx.fr
        users:
          - name: admin
            primary_group: root
            lock_passwd: false
            # admin user password is : secretdemerde
            passwd: $6$rounds=4096$JnxzALRiq8YtBpUS$G5eFZCw1Ega9r7hbSxeE74WRzsUjfwG/mhbmSUhQNhLnzNPnaOZOQ7zlogCqwYzvYRSU223Py3SGwEksWX4zJ/
            sudo: ALL=(ALL) NOPASSWD:ALL
            ssh_authorized_keys:
              - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDWDlg68Uc8j5qBA4OYfxvlMc2nSmL6cb8esoy+cPFeIstafJfza1G+Q5wiMf8QBNqWHi03hnoFaElI148thiwwd9fLIz7KQ+lSk7UQAlkZ4AH5L9B+NkUzydhccNT/xNEqO7M/JwMYDS96iyr3NnbYyiDJg+OOCO5l1ebhA2b0XzFOaNeEGbDizb7QLADg6mbcgnaLhb17nI7G90fJE1jJymX1Q/aQFQqcZrv7jA5lvxAoxHW0llTGnF8IpsOoQT9pbVZxoxUJgR9dc7uIKyZcXo6UKw9pkoA3wzsutv6aLTKaG2SwOxNDJxBx98C4XURMUr0dU5vHCTbhPNZYTZIjhPauPxyy2ud0kLUImXFlz7dnNThOfZFp0dSMAx+8s9E0dVzbjqurILsPNLKP4Zjkk13KtWh6qI6VhdiXKOTpokkAFenV5d2hwP0WwL9MOU297u3i1XpS9FdrJZgQH5M1Dp9/fwSYcwbSFbj7f3qZ3NGvaM6VqfW6o6iMPWEkKYo36P0OrkuYsgMRr4w25IUAXI00mzYzN1D7T1nkMIX4JGlemh065536/z8MeKPoFhmRVqlAykJDXEvfNef0m8DjwxnroGQmre/4ewyif0q0I7K+Aj/xjSEqO+MLuNMUXJCWi08uzM0v+YSsJkADKmJH2kWPjrA4sbsAn0c8EDPDJQ== dev@startx.fr
            ssh_import_id: None
    - name: "startx-demo-centos7-vm"
      namespace: "demo-kubevirt"
      hostname: "startx-demo-centos7-vm.local"
      os: 
        name: "CentOS 7"
        signature: "centos7.0"
        image: "https://cloud.centos.org/centos/7/images/CentOS-7-x86_64-GenericCloud-1907.qcow2"
      storage:
        boot_size: 15G
        boot_storageclass: startx-aws-generic-delete
        disks: 
        - name: disk0
          storageclass: startx-aws-generic-delete
          size: 10G
          boot_order: 3
      cloudInit: |
        #cloud-config
        name: centos7
        hostname: "centos7-vm.local"
        ssh_authorized_keys:
          - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDWDlg68Uc8j5qBA4OYfxvlMc2nSmL6cb8esoy+cPFeIstafJfza1G+Q5wiMf8QBNqWHi03hnoFaElI148thiwwd9fLIz7KQ+lSk7UQAlkZ4AH5L9B+NkUzydhccNT/xNEqO7M/JwMYDS96iyr3NnbYyiDJg+OOCO5l1ebhA2b0XzFOaNeEGbDizb7QLADg6mbcgnaLhb17nI7G90fJE1jJymX1Q/aQFQqcZrv7jA5lvxAoxHW0llTGnF8IpsOoQT9pbVZxoxUJgR9dc7uIKyZcXo6UKw9pkoA3wzsutv6aLTKaG2SwOxNDJxBx98C4XURMUr0dU5vHCTbhPNZYTZIjhPauPxyy2ud0kLUImXFlz7dnNThOfZFp0dSMAx+8s9E0dVzbjqurILsPNLKP4Zjkk13KtWh6qI6VhdiXKOTpokkAFenV5d2hwP0WwL9MOU297u3i1XpS9FdrJZgQH5M1Dp9/fwSYcwbSFbj7f3qZ3NGvaM6VqfW6o6iMPWEkKYo36P0OrkuYsgMRr4w25IUAXI00mzYzN1D7T1nkMIX4JGlemh065536/z8MeKPoFhmRVqlAykJDXEvfNef0m8DjwxnroGQmre/4ewyif0q0I7K+Aj/xjSEqO+MLuNMUXJCWi08uzM0v+YSsJkADKmJH2kWPjrA4sbsAn0c8EDPDJQ== dev@startx.fr
        users:
          - name: admin
            primary_group: root
            lock_passwd: false
            # admin user password is : secretdemerde
            passwd: $6$rounds=4096$JnxzALRiq8YtBpUS$G5eFZCw1Ega9r7hbSxeE74WRzsUjfwG/mhbmSUhQNhLnzNPnaOZOQ7zlogCqwYzvYRSU223Py3SGwEksWX4zJ/
            sudo: ALL=(ALL) NOPASSWD:ALL
            ssh_authorized_keys:
              - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDWDlg68Uc8j5qBA4OYfxvlMc2nSmL6cb8esoy+cPFeIstafJfza1G+Q5wiMf8QBNqWHi03hnoFaElI148thiwwd9fLIz7KQ+lSk7UQAlkZ4AH5L9B+NkUzydhccNT/xNEqO7M/JwMYDS96iyr3NnbYyiDJg+OOCO5l1ebhA2b0XzFOaNeEGbDizb7QLADg6mbcgnaLhb17nI7G90fJE1jJymX1Q/aQFQqcZrv7jA5lvxAoxHW0llTGnF8IpsOoQT9pbVZxoxUJgR9dc7uIKyZcXo6UKw9pkoA3wzsutv6aLTKaG2SwOxNDJxBx98C4XURMUr0dU5vHCTbhPNZYTZIjhPauPxyy2ud0kLUImXFlz7dnNThOfZFp0dSMAx+8s9E0dVzbjqurILsPNLKP4Zjkk13KtWh6qI6VhdiXKOTpokkAFenV5d2hwP0WwL9MOU297u3i1XpS9FdrJZgQH5M1Dp9/fwSYcwbSFbj7f3qZ3NGvaM6VqfW6o6iMPWEkKYo36P0OrkuYsgMRr4w25IUAXI00mzYzN1D7T1nkMIX4JGlemh065536/z8MeKPoFhmRVqlAykJDXEvfNef0m8DjwxnroGQmre/4ewyif0q0I7K+Aj/xjSEqO+MLuNMUXJCWi08uzM0v+YSsJkADKmJH2kWPjrA4sbsAn0c8EDPDJQ== dev@startx.fr
            ssh_import_id: None
    - name: "startx-demo-fedora33-vm"
      namespace: "demo-kubevirt"
      hostname: "startx-demo-fedora33-vm.local"
      os: 
        name: "Fedora 33"
        signature: "fedora33.0"
        image: "https://fr2.rpmfind.net/linux/fedora/linux/releases/33/Cloud/x86_64/images/Fedora-Cloud-Base-33-1.2.x86_64.qcow2"
      storage:
        boot_size: 15G
        boot_storageclass: startx-odf-generic-delete
        disks: 
        - name: disk0
          storageclass: startx-odf-generic-delete
          size: 10G
          boot_order: 3
      cloudInit: |
        #cloud-config
        name: fedora33
        hostname: "fedora33-vm.local"
        ssh_authorized_keys:
          - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDWDlg68Uc8j5qBA4OYfxvlMc2nSmL6cb8esoy+cPFeIstafJfza1G+Q5wiMf8QBNqWHi03hnoFaElI148thiwwd9fLIz7KQ+lSk7UQAlkZ4AH5L9B+NkUzydhccNT/xNEqO7M/JwMYDS96iyr3NnbYyiDJg+OOCO5l1ebhA2b0XzFOaNeEGbDizb7QLADg6mbcgnaLhb17nI7G90fJE1jJymX1Q/aQFQqcZrv7jA5lvxAoxHW0llTGnF8IpsOoQT9pbVZxoxUJgR9dc7uIKyZcXo6UKw9pkoA3wzsutv6aLTKaG2SwOxNDJxBx98C4XURMUr0dU5vHCTbhPNZYTZIjhPauPxyy2ud0kLUImXFlz7dnNThOfZFp0dSMAx+8s9E0dVzbjqurILsPNLKP4Zjkk13KtWh6qI6VhdiXKOTpokkAFenV5d2hwP0WwL9MOU297u3i1XpS9FdrJZgQH5M1Dp9/fwSYcwbSFbj7f3qZ3NGvaM6VqfW6o6iMPWEkKYo36P0OrkuYsgMRr4w25IUAXI00mzYzN1D7T1nkMIX4JGlemh065536/z8MeKPoFhmRVqlAykJDXEvfNef0m8DjwxnroGQmre/4ewyif0q0I7K+Aj/xjSEqO+MLuNMUXJCWi08uzM0v+YSsJkADKmJH2kWPjrA4sbsAn0c8EDPDJQ== dev@startx.fr
        users:
          - name: admin
            primary_group: root
            lock_passwd: false
            # admin user password is : secretdemerde
            passwd: $6$rounds=4096$JnxzALRiq8YtBpUS$G5eFZCw1Ega9r7hbSxeE74WRzsUjfwG/mhbmSUhQNhLnzNPnaOZOQ7zlogCqwYzvYRSU223Py3SGwEksWX4zJ/
            sudo: ALL=(ALL) NOPASSWD:ALL
            ssh_authorized_keys:
              - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDWDlg68Uc8j5qBA4OYfxvlMc2nSmL6cb8esoy+cPFeIstafJfza1G+Q5wiMf8QBNqWHi03hnoFaElI148thiwwd9fLIz7KQ+lSk7UQAlkZ4AH5L9B+NkUzydhccNT/xNEqO7M/JwMYDS96iyr3NnbYyiDJg+OOCO5l1ebhA2b0XzFOaNeEGbDizb7QLADg6mbcgnaLhb17nI7G90fJE1jJymX1Q/aQFQqcZrv7jA5lvxAoxHW0llTGnF8IpsOoQT9pbVZxoxUJgR9dc7uIKyZcXo6UKw9pkoA3wzsutv6aLTKaG2SwOxNDJxBx98C4XURMUr0dU5vHCTbhPNZYTZIjhPauPxyy2ud0kLUImXFlz7dnNThOfZFp0dSMAx+8s9E0dVzbjqurILsPNLKP4Zjkk13KtWh6qI6VhdiXKOTpokkAFenV5d2hwP0WwL9MOU297u3i1XpS9FdrJZgQH5M1Dp9/fwSYcwbSFbj7f3qZ3NGvaM6VqfW6o6iMPWEkKYo36P0OrkuYsgMRr4w25IUAXI00mzYzN1D7T1nkMIX4JGlemh065536/z8MeKPoFhmRVqlAykJDXEvfNef0m8DjwxnroGQmre/4ewyif0q0I7K+Aj/xjSEqO+MLuNMUXJCWi08uzM0v+YSsJkADKmJH2kWPjrA4sbsAn0c8EDPDJQ== dev@startx.fr
            ssh_import_id: None
    - name: "startx-demo-cirros-vm"
      namespace: "demo-kubevirt"
      hostname: "startx-demo-cirros-vm.local"
      os: 
        name: "Cirros OS"
        signature: "fc31.0"
      storage:
        boot_image: "kubevirt/cirros-registry-disk-demo"
        boot_type: "containerDisk"
        boot_size: 5G
        boot_storageclass: startx-aws-generic-delete
      cloudInit: |
        #cloud-config
        name: cirros
        hostname: "startx-demo-cirros-vm.local"
        ssh_authorized_keys:
          - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDWDlg68Uc8j5qBA4OYfxvlMc2nSmL6cb8esoy+cPFeIstafJfza1G+Q5wiMf8QBNqWHi03hnoFaElI148thiwwd9fLIz7KQ+lSk7UQAlkZ4AH5L9B+NkUzydhccNT/xNEqO7M/JwMYDS96iyr3NnbYyiDJg+OOCO5l1ebhA2b0XzFOaNeEGbDizb7QLADg6mbcgnaLhb17nI7G90fJE1jJymX1Q/aQFQqcZrv7jA5lvxAoxHW0llTGnF8IpsOoQT9pbVZxoxUJgR9dc7uIKyZcXo6UKw9pkoA3wzsutv6aLTKaG2SwOxNDJxBx98C4XURMUr0dU5vHCTbhPNZYTZIjhPauPxyy2ud0kLUImXFlz7dnNThOfZFp0dSMAx+8s9E0dVzbjqurILsPNLKP4Zjkk13KtWh6qI6VhdiXKOTpokkAFenV5d2hwP0WwL9MOU297u3i1XpS9FdrJZgQH5M1Dp9/fwSYcwbSFbj7f3qZ3NGvaM6VqfW6o6iMPWEkKYo36P0OrkuYsgMRr4w25IUAXI00mzYzN1D7T1nkMIX4JGlemh065536/z8MeKPoFhmRVqlAykJDXEvfNef0m8DjwxnroGQmre/4ewyif0q0I7K+Aj/xjSEqO+MLuNMUXJCWi08uzM0v+YSsJkADKmJH2kWPjrA4sbsAn0c8EDPDJQ== dev@startx.fr
        users:
          - name: admin
            primary_group: root
            lock_passwd: false
            # admin user password is : secretdemerde
            passwd: $6$rounds=4096$JnxzALRiq8YtBpUS$G5eFZCw1Ega9r7hbSxeE74WRzsUjfwG/mhbmSUhQNhLnzNPnaOZOQ7zlogCqwYzvYRSU223Py3SGwEksWX4zJ/
            sudo: ALL=(ALL) NOPASSWD:ALL
            ssh_authorized_keys:
              - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDWDlg68Uc8j5qBA4OYfxvlMc2nSmL6cb8esoy+cPFeIstafJfza1G+Q5wiMf8QBNqWHi03hnoFaElI148thiwwd9fLIz7KQ+lSk7UQAlkZ4AH5L9B+NkUzydhccNT/xNEqO7M/JwMYDS96iyr3NnbYyiDJg+OOCO5l1ebhA2b0XzFOaNeEGbDizb7QLADg6mbcgnaLhb17nI7G90fJE1jJymX1Q/aQFQqcZrv7jA5lvxAoxHW0llTGnF8IpsOoQT9pbVZxoxUJgR9dc7uIKyZcXo6UKw9pkoA3wzsutv6aLTKaG2SwOxNDJxBx98C4XURMUr0dU5vHCTbhPNZYTZIjhPauPxyy2ud0kLUImXFlz7dnNThOfZFp0dSMAx+8s9E0dVzbjqurILsPNLKP4Zjkk13KtWh6qI6VhdiXKOTpokkAFenV5d2hwP0WwL9MOU297u3i1XpS9FdrJZgQH5M1Dp9/fwSYcwbSFbj7f3qZ3NGvaM6VqfW6o6iMPWEkKYo36P0OrkuYsgMRr4w25IUAXI00mzYzN1D7T1nkMIX4JGlemh065536/z8MeKPoFhmRVqlAykJDXEvfNef0m8DjwxnroGQmre/4ewyif0q0I7K+Aj/xjSEqO+MLuNMUXJCWi08uzM0v+YSsJkADKmJH2kWPjrA4sbsAn0c8EDPDJQ== dev@startx.fr
            ssh_import_id: None





---
kind: Project
apiVersion: project.openshift.io/v1
metadata:
  name: myapp
  labels:
    kubernetes.io/metadata.name: myapp
  annotations:
    openshift.io/description: 'Demo of my application migration to containers'
    openshift.io/display-name: 'My Application'
    openshift.io/requester: startx
spec: {}
---
kind: VirtualMachine
apiVersion: kubevirt.io/v1
metadata:
  name: frontend-v0
  namespace: myapp
  labels:
    app: frontend
    version: v0
    app.kubernetes.io/part-of: myapp
    app.kubernetes.io/component: frontend
    app.kubernetes.io/instance: frontend-v0
    app.kubernetes.io/name: frontend-v0
    app.openshift.io/runtime: php
    vm.kubevirt.io/template: fedora-server-small
    vm.kubevirt.io/template.namespace: openshift
    vm.kubevirt.io/template.revision: '1'
    vm.kubevirt.io/template.version: v0.24.2
spec:
  dataVolumeTemplates:
    - apiVersion: cdi.kubevirt.io/v1beta1
      kind: DataVolume
      metadata:
        creationTimestamp: null
        name: frontend-v0
      spec:
        sourceRef:
          kind: DataSource
          name: fedora
          namespace: openshift-virtualization-os-images
        storage:
          resources:
            requests:
              storage: 30Gi
  running: true
  template:
    metadata:
      annotations:
        vm.kubevirt.io/flavor: small
        vm.kubevirt.io/os: fedora
        vm.kubevirt.io/workload: server
      creationTimestamp: null
      labels:
        kubevirt.io/domain: frontend-v0
        app: frontend
        version: v0
        app.kubernetes.io/part-of: myapp
        app.kubernetes.io/component: frontend
        app.kubernetes.io/instance: frontend-v0
        app.kubernetes.io/name: frontend-v0
        app.openshift.io/runtime: php
        kubevirt.io/size: small
    spec:
      domain:
        cpu:
          cores: 1
          sockets: 1
          threads: 1
        devices:
          disks:
            - disk:
                bus: virtio
              name: rootdisk
            - disk:
                bus: virtio
              name: cloudinitdisk
          interfaces:
            - name: default
              masquerade: {}
              model: virtio
          networkInterfaceMultiqueue: true
          rng: {}
        features:
          acpi: {}
          smm:
            enabled: true
        firmware:
          bootloader:
            efi: {}
        machine:
          type: pc-q35-rhel8.6.0
        resources:
          requests:
            memory: 2Gi
      evictionStrategy: None
      networks:
        - name: default
          pod: {}
      terminationGracePeriodSeconds: 180
      volumes:
        - name: rootdisk
          dataVolume:
            name: frontend-v0
        - name: cloudinitdisk
          cloudInitNoCloud:
            userData: |-
              #cloud-config
              user: admin
              password: motdepasse
              chpasswd: { expire: False }
              hostname: frontend-v0
              package_update: true
              package_upgrade: true
              users:
                - name: admin
                  password: motdepasse
                  chpasswd: { expire: False }
                  groups: [ wheel , sudo ]
                  shell: /bin/bash
                  sudo: ['ALL=(ALL) NOPASSWD:ALL']
                - name: dev
                  plain_text_passwd: dev123
                  chpasswd: { expire: False }
              packages:
              - httpd
              - httpd-tools 
              - php-fpm
              - php-cli
              - php
              - git
              runcmd:
              # On active le serveur httpd
              - systemctl enable httpd
              - systemctl start httpd
              # On install la v0 du site myapp frontend
              - git clone https://github.com/startxfr/docker-images-example-php /var/www/html/
              - cd /var/www/html/
              - git checkout v0
              - rm -rf /var/www/html/.git
              # On coupe l'accès au compte root pour la connexion SSH
              - sed -i 's/^#\?PermitRootLogin.*/PermitRootLogin no/g' /etc/ssh/sshd_config
              - systemctl restart sshd.service
              final_message: "Le système est configuré et l'application my-app v0 exposee"
---
kind: Service
apiVersion: v1
metadata:
  name: frontend-v0
  namespace: myapp
spec:
  ipFamilies:
    - IPv4
  ports:
    - name: http
      protocol: TCP
      port: 8080
      targetPort: 80
  internalTrafficPolicy: Cluster
  type: ClusterIP
  ipFamilyPolicy: SingleStack
  sessionAffinity: None
  selector:
    app: frontend
    version: v0
    app.kubernetes.io/part-of: myapp
---
kind: Route
apiVersion: route.openshift.io/v1
metadata:
  name: frontend-v0
  namespace: myapp
spec:
  to:
    kind: Service
    name: frontend-v0
    weight: 100
  port:
    targetPort: http
  tls:
    termination: edge
  wildcardPolicy: None
---
kind: Route
apiVersion: route.openshift.io/v1
metadata:
  name: frontend
  namespace: myapp
  annotations:
    haproxy.router.openshift.io/balance: roundrobin
    haproxy.router.openshift.io/disable_cookies: 'true'
spec:
  to:
    kind: Service
    name: frontend-v0
    weight: 50
  alternateBackends:
    - kind: Service
      name: frontend-v1
      weight: 50
  port:
    targetPort: http
  tls:
    termination: edge
  wildcardPolicy: None
---
kind: Pipeline
apiVersion: tekton.dev/v1beta1
metadata:
  name: frontend-v1
  namespace: myapp
  labels:
    app.kubernetes.io/instance: frontend-v1
    app.kubernetes.io/name: frontend-v1
    pipeline.openshift.io/runtime: php
    pipeline.openshift.io/runtime-version: 8.0-ubi9
spec:
  params:
    - default: frontend-v1
      name: APP_NAME
      type: string
    - default: 'https://github.com/startxfr/docker-images-example-php.git'
      name: GIT_REPO
      type: string
    - default: v1
      name: GIT_REVISION
      type: string
    - default: 'image-registry.openshift-image-registry.svc:5000/myapp/frontend-v1'
      name: IMAGE_NAME
      type: string
    - default: .
      name: PATH_CONTEXT
      type: string
    - default: 8.0-ubi9
      name: VERSION
      type: string
  tasks:
    - name: fetch-repository
      params:
        - name: url
          value: $(params.GIT_REPO)
        - name: revision
          value: $(params.GIT_REVISION)
        - name: subdirectory
          value: ''
        - name: deleteExisting
          value: 'true'
      taskRef:
        kind: ClusterTask
        name: git-clone
      workspaces:
        - name: output
          workspace: workspace
    - name: build
      params:
        - name: IMAGE
          value: $(params.IMAGE_NAME)
        - name: TLSVERIFY
          value: 'false'
        - name: PATH_CONTEXT
          value: $(params.PATH_CONTEXT)
        - name: VERSION
          value: $(params.VERSION)
      runAfter:
        - fetch-repository
      taskRef:
        kind: ClusterTask
        name: s2i-php
      workspaces:
        - name: source
          workspace: workspace
    - name: deploy
      params:
        - name: SCRIPT
          value: oc rollout status deploy/$(params.APP_NAME)
      runAfter:
        - build
      taskRef:
        kind: ClusterTask
        name: openshift-client
  workspaces:
    - name: workspace
      optional: false
  resources: []
  finally: []
---
kind: PipelineRun
apiVersion: tekton.dev/v1beta1
metadata:
  annotations:
    chains.tekton.dev/signed: 'true'
    pipeline.openshift.io/started-by: startx
  name: frontend-v1-run
  namespace: myapp
  labels:
    app.kubernetes.io/instance: frontend-v1
    app.kubernetes.io/name: frontend-v1
    operator.tekton.dev/operand-name: openshift-pipelines-addons
    pipeline.openshift.io/runtime: php
    pipeline.openshift.io/runtime-version: 8.0-ubi9
    pipeline.openshift.io/type: kubernetes
    tekton.dev/pipeline: frontend-v1
spec:
  params:
    - name: APP_NAME
      value: frontend-v1
    - name: GIT_REPO
      value: 'https://github.com/startxfr/docker-images-example-php.git'
    - name: GIT_REVISION
      value: v1
    - name: IMAGE_NAME
      value: 'image-registry.openshift-image-registry.svc:5000/myapp/frontend-v1'
    - name: PATH_CONTEXT
      value: .
    - name: VERSION
      value: 8.0-ubi9
  pipelineRef:
    name: frontend-v1
  serviceAccountName: pipeline
  timeout: 1h0m0s
  workspaces:
    - name: workspace
      volumeClaimTemplate:
        metadata:
          creationTimestamp: null
          labels:
            tekton.dev/pipeline: frontend-v1
        spec:
          accessModes:
            - ReadWriteOnce
          resources:
            requests:
              storage: 1Gi
        status: {}
---
kind: Deployment
apiVersion: apps/v1
metadata:
  annotations:
    alpha.image.policy.openshift.io/resolve-names: '*'
    app.openshift.io/route-disabled: 'false'
    app.openshift.io/vcs-ref: v1
    app.openshift.io/vcs-uri: 'https://github.com/startxfr/docker-images-example-php.git'
    image.openshift.io/triggers: >-
      [{"from":{"kind":"ImageStreamTag","name":"frontend-v1:latest","namespace":"myapp"},"fieldPath":"spec.template.spec.containers[?(@.name==\"frontend-v1\")].image","pause":"false"}]
  name: frontend-v1
  namespace: myapp
  labels:
    app: frontend
    version: v1
    app.kubernetes.io/part-of: myapp
    app.kubernetes.io/component: frontend
    app.kubernetes.io/instance: frontend-v1
    app.kubernetes.io/name: frontend-v1
    app.openshift.io/runtime: php
    app.openshift.io/runtime-version: 8.0-ubi9
spec:
  replicas: 2
  selector:
    matchLabels:
      app: frontend
      version: v1
      app.kubernetes.io/part-of: myapp
      deployment: frontend-v1
  template:
    metadata:
      creationTimestamp: null
      labels:
        app: frontend
        version: v1
        app.kubernetes.io/part-of: myapp
        deployment: frontend-v1
    spec:
      containers:
        - name: frontend
          image: >-
            image-registry.openshift-image-registry.svc:5000/myapp/frontend-v1:latest
          ports:
            - containerPort: 8080
              protocol: TCP
            - containerPort: 8443
              protocol: TCP
          resources:
            requests:
              memory: "256Mi"
              cpu: "200m"
              ephemeral-storage: "200Mi"
            limits:
              memory: "512Mi"
              cpu: "500m"
              ephemeral-storage: "1Gi"
          imagePullPolicy: Always
      restartPolicy: Always
      terminationGracePeriodSeconds: 30
      dnsPolicy: ClusterFirst
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxUnavailable: 25%
      maxSurge: 25%
  revisionHistoryLimit: 6
  progressDeadlineSeconds: 600
---
kind: Service
apiVersion: v1
metadata:
  name: frontend-v1
  namespace: myapp
spec:
  ipFamilies:
    - IPv4
  ports:
    - name: http
      protocol: TCP
      port: 8080
      targetPort: 8080
  internalTrafficPolicy: Cluster
  type: ClusterIP
  ipFamilyPolicy: SingleStack
  sessionAffinity: None
  selector:
    app: frontend
    version: v1
    app.kubernetes.io/part-of: myapp
---
kind: Route
apiVersion: route.openshift.io/v1
metadata:
  name: frontend-v1
  namespace: myapp
spec:
  to:
    kind: Service
    name: frontend-v1
    weight: 100
  port:
    targetPort: http
  tls:
    termination: edge
  wildcardPolicy: None
