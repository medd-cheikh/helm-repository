# Default values for configuration of a STARTX cluster
# see values.yaml for explanation on each params
context: &context
  scope: startx
  cluster: localhost
  environment: infra
  component: couchbase
  app: demo-couchbase

couchbaseConfig:
  enabled: false

loader:
  enabled: false

cluster:
  enabled: true
  list: 
  - name: mercury-cluster
    enabled: true
    admin:
      username: "administrator"
      password: "administrator123"
    expose:
      enabled: true
    spec: |
      image: registry.connect.redhat.com/couchbase/server:6.5.1
      paused: false
      antiAffinity: true
      softwareUpdateNotifications: true
      serverGroups:
        - eu-west-2a
        - eu-west-2b
        - eu-west-2c
      securityContext:
        runAsUser: 1000
        runAsNonRoot: true
        fsGroup: 1000
      security:
        adminSecret: mercury-cluster-admin-auth
        rbac:
          managed: true
          selector:
            matchLabels:
              cluster: mercury-cluster
      networking:
        exposeAdminConsole: true
        adminConsoleServices:
        - data
      buckets:
        managed: true
        selector:
          matchLabels:
            cluster: mercury-cluster
      logging:
        logRetentionTime: 604800s
        logRetentionCount: 20
      backup:
        managed: true
        image: couchbase/operator-backup:6.5.0
        serviceAccountName: couchbase-backup
        resources:
          requests:
            cpu: 100m
            memory: 100Mi
        selector:
          matchLabels:
            cluster: mercury-cluster
      volumeClaimTemplates:
      - metadata:
          name: couchbase
        spec:
          storageClassName: "gp2"
          resources:
            requests:
              storage: 2Gi
      cluster:
        clusterName: mercury-cluster
        dataServiceMemoryQuota: 512Mi
        indexServiceMemoryQuota: 256Mi
        searchServiceMemoryQuota: 256Mi
        eventingServiceMemoryQuota: 256Mi
        analyticsServiceMemoryQuota: 1Gi
        indexStorageSetting: memory_optimized
        autoFailoverTimeout: 120s
        autoFailoverMaxCount: 3
        autoFailoverOnDataDiskIssues: true
        autoFailoverOnDataDiskIssuesTimePeriod: 120s
        autoFailoverServerGroup: false
        autoCompaction:
          databaseFragmentationThreshold:
            percent: 30
            size: 1Gi
          viewFragmentationThreshold:
            percent: 30
            size: 1Gi
          parallelCompaction: false
          timeWindow:
            start: 02:00
            end: 06:00
            abortCompactionOutsideWindow: true
          tombstonePurgeInterval: 72h
      servers:
      - name: all_services
        size: 3
        services:
        - data
        - index
        - query
        - search
        - eventing
        - analytics
        serverGroups:
        - eu-west-2a
        - eu-west-2b
        - eu-west-2c
        resources:
          limits:
            cpu: "1500m"
            memory: 5Gi
          requests:
            cpu: "400m"
            memory: 3Gi
        volumeMounts:
          default: couchbase
          data:  couchbase
          index: couchbase
          analytics:
          - couchbase
          - couchbase
        pod:
          metadata:
            labels:
              couchbase_services: all
            annotations:
              couchbase.startx.fr: mercury
          spec:
            automountServiceAccountToken: false
            serviceAccountName: couchbase-pods
            containers: []
            imagePullSecrets:
              - name: "startx-couchbase-rhn"
    buckets: 
    - name: "purple-bucket"
      kind: couchbase
      spec: |
        memoryQuota: 128Mi
        replicas: 2
        ioPriority: low
        evictionPolicy: valueOnly
        conflictResolution: lww
        enableFlush: true
        enableIndexReplica: true
        compressionMode: passive

project: 
  enabled: false
  context: 
    <<: *context

operator:
  enabled: false
  context: 
    <<: *context
