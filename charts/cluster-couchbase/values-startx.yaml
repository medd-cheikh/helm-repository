# Default values for configuration of a STARTX cluster
# see values.yaml for explanation on each params
context: &context
  scope: startx
  cluster: localhost
  environment: infra
  component: couchbase
  app: startx-couchbase

couchbaseConfig:
  enabled: true
  saPods: 
    enabled: true
    name: couchbase-pods
  saBackup: 
    enabled: true
    name: couchbase-backup
  imageCredentials:
    enabled: false
    registry: registry.connect.redhat.com
    username: startx_cl
    password: 8password
    email: cl@startx.fr

cluster:
  enabled: true
  list: 
  - name: startx-dev-cluster
    enabled: true
    admin:
      username: "administrator"
      password: "administrator123"
    expose:
      enabled: true
    spec: |
      image: registry.connect.redhat.com/couchbase/server:6.5.1
      paused: false
      antiAffinity: true
      softwareUpdateNotifications: true
      serverGroups:
        - eu-west-3a
        - eu-west-3b
        - eu-west-3c
      securityContext:
        runAsUser: 1000
        runAsNonRoot: true
        fsGroup: 1000
      security:
        adminSecret: startx-dev-cluster-admin-auth
        rbac:
          managed: true
          selector:
            matchLabels:
              cluster: startx-dev-cluster
      networking:
        exposeAdminConsole: true
        adminConsoleServices:
        - data
      buckets:
        managed: true
        selector:
          matchLabels:
            cluster: startx-dev-cluster
      logging:
        logRetentionTime: 604800s
        logRetentionCount: 20
      backup:
        managed: true
        image: couchbase/operator-backup:6.5.0
        serviceAccountName: couchbase-backup
        resources:
          requests:
            cpu: 100m
            memory: 100Mi
        selector:
          matchLabels:
            cluster: startx-dev-cluster
      volumeClaimTemplates:
      - metadata:
          name: couchbase
        spec:
          storageClassName: "gp2"
          resources:
            requests:
              storage: 2Gi
      cluster:
        clusterName: startx-dev-cluster
        dataServiceMemoryQuota: 750Mi
        indexServiceMemoryQuota: 256Mi
        searchServiceMemoryQuota: 256Mi
        eventingServiceMemoryQuota: 256Mi
        analyticsServiceMemoryQuota: 1Gi
        indexStorageSetting: memory_optimized
        autoFailoverTimeout: 120s
        autoFailoverMaxCount: 3
        autoFailoverOnDataDiskIssues: true
        autoFailoverOnDataDiskIssuesTimePeriod: 120s
        autoFailoverServerGroup: false
        autoCompaction:
          databaseFragmentationThreshold:
            percent: 30
            size: 1Gi
          viewFragmentationThreshold:
            percent: 30
            size: 1Gi
          parallelCompaction: false
          timeWindow:
            start: 02:00
            end: 06:00
            abortCompactionOutsideWindow: true
          tombstonePurgeInterval: 72h
      servers:
      - name: all_services
        size: 3
        services:
        - data
        - index
        - query
        - search
        - eventing
        - analytics
        serverGroups:
        - eu-west-3a
        - eu-west-3b
        - eu-west-3c
        resources:
          limits:
            cpu: "4"
            memory: 6Gi
          requests:
            cpu: "2"
            memory: 4Gi
        volumeMounts:
          default: couchbase
          data:  couchbase
          index: couchbase
          analytics:
          - couchbase
          - couchbase
        pod:
          metadata:
            labels:
              couchbase_services: all
            annotations:
              couchbase.startx.fr: startx-dev
          spec:
            automountServiceAccountToken: false
            serviceAccountName: couchbase-pods
            containers: []
            imagePullSecrets:
              - name: "startx-couchbase-rhn"
    buckets: 
    - name: "yellow-bucket"
      kind: couchbase
      spec: |
        memoryQuota: 128Mi
        replicas: 2
        ioPriority: low
        evictionPolicy: valueOnly
        conflictResolution: lww
        enableFlush: true
        enableIndexReplica: true
        compressionMode: passive
    - name: "orange-back-bucket"
      kind: ephemeral
      spec: |
        memoryQuota: 100Mi
        replicas: 2
        ioPriority: low
        evictionPolicy: noEviction
        conflictResolution: lww
        enableFlush: false
        compressionMode: passive
    - name: "black-bucket"
      kind: memcached
      spec: |
        memoryQuota: 100Mi
        enableFlush: false
  - name: startx-prod-cluster
    enabled: true
    admin:
      username: "administrator"
      password: "administrator123"
    expose:
      enabled: true
    spec: |
      image: registry.connect.redhat.com/couchbase/server:6.5.1
      paused: false
      antiAffinity: true
      softwareUpdateNotifications: true
      serverGroups:
        - eu-west-3a
        - eu-west-3b
        - eu-west-3c
      securityContext:
        runAsUser: 1000
        runAsNonRoot: true
        fsGroup: 1000
      security:
        adminSecret: startx-prod-cluster-admin-auth
        rbac:
          managed: true
          selector:
            matchLabels:
              cluster: startx-prod-cluster
      networking:
        exposeAdminConsole: true
        adminConsoleServices:
        - data
      buckets:
        managed: true
        selector:
          matchLabels:
            cluster: startx-prod-cluster
      logging:
        logRetentionTime: 604800s
        logRetentionCount: 20
      backup:
        managed: true
        image: couchbase/operator-backup:6.5.0
        serviceAccountName: couchbase-backup
        resources:
          requests:
            cpu: 100m
            memory: 100Mi
        selector:
          matchLabels:
            cluster: startx-prod-cluster
      volumeClaimTemplates:
      - metadata:
          name: couchbase
        spec:
          storageClassName: "gp2"
          resources:
            requests:
              storage: 2Gi
      cluster:
        clusterName: startx-prod-cluster
        dataServiceMemoryQuota: 512Mi
        indexServiceMemoryQuota: 256Mi
        searchServiceMemoryQuota: 256Mi
        eventingServiceMemoryQuota: 256Mi
        analyticsServiceMemoryQuota: 1Gi
        indexStorageSetting: memory_optimized
        autoFailoverTimeout: 120s
        autoFailoverMaxCount: 3
        autoFailoverOnDataDiskIssues: true
        autoFailoverOnDataDiskIssuesTimePeriod: 120s
        autoFailoverServerGroup: false
        autoCompaction:
          databaseFragmentationThreshold:
            percent: 30
            size: 1Gi
          viewFragmentationThreshold:
            percent: 30
            size: 1Gi
          parallelCompaction: false
          timeWindow:
            start: 02:00
            end: 06:00
            abortCompactionOutsideWindow: true
          tombstonePurgeInterval: 72h
      servers:
      - name: all_services
        size: 3
        services:
        - data
        - index
        - query
        - search
        - eventing
        - analytics
        serverGroups:
        - eu-west-3a
        - eu-west-3b
        - eu-west-3c
        resources:
          limits:
            cpu: "3"
            memory: 5Gi
          requests:
            cpu: "1500"
            memory: 3Gi
        volumeMounts:
          default: couchbase
          data:  couchbase
          index: couchbase
          analytics:
          - couchbase
          - couchbase
        pod:
          metadata:
            labels:
              couchbase_services: all
            annotations:
              couchbase.startx.fr: startx-prod
          spec:
            automountServiceAccountToken: false
            serviceAccountName: couchbase-pods
            containers: []
            imagePullSecrets:
              - name: "startx-couchbase-rhn"
    buckets: 
    - name: "yellow-back-bucket"
      kind: couchbase
      spec: |
        memoryQuota: 128Mi
        replicas: 2
        ioPriority: low
        evictionPolicy: valueOnly
        conflictResolution: lww
        enableFlush: true
        enableIndexReplica: true
        compressionMode: passive
    - name: "orange-bucket"
      kind: ephemeral
      spec: |
        memoryQuota: 100Mi
        replicas: 2
        ioPriority: low
        evictionPolicy: noEviction
        conflictResolution: lww
        enableFlush: false
        compressionMode: passive

project: 
  enabled: false
  context: 
    <<: *context
  project: 
    enabled: true
    hooked: false
    type: project
    name: "demo-couchbase"
    display_name: "Demo COUCHBASE"
    requester: startx
    description: Demo Couchbase configured by STARTX
operator:
  enabled: false
  context: 
    <<: *context
  subscription:
    enabled: true
    hooked: false
    name: "couchbase-enterprise-certified"
    namespace: "demo-couchbase"
    version: "v2.1.0"
    operator: 
      channel: stable
      name: couchbase-enterprise-certified
      csv: couchbase-operator
      source: 
        name: certified-operators
        namespace: openshift-marketplace
  operatorGroup:
    enabled: true
    hooked: false
    name: "couchbase-operator-v2"
    namespace: "demo-couchbase"
    providedAPIs: "CouchbaseAutoscaler.v2.couchbase.com,CouchbaseBackup.v2.couchbase.com,CouchbaseBackupRestore.v2.couchbase.com,CouchbaseBucket.v2.couchbase.com,CouchbaseCluster.v2.couchbase.com,CouchbaseEphemeralBucket.v2.couchbase.com,CouchbaseGroup.v2.couchbase.com,CouchbaseMemcachedBucket.v2.couchbase.com,CouchbaseReplication.v2.couchbase.com,CouchbaseRoleBinding.v2.couchbase.com,CouchbaseUser.v2.couchbase.com"
