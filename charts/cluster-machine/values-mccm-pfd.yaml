# Default values for configuration of a STARTX cluster
# see values.yaml for explanation on each params
context: 
  scope: mccm
  cluster: mccm-client
  environment: client
  component: machine
  app: mccm-machine

cluster:
  id: startx-xyzab
  region: eu-west-3
  autoscaler: 
    enabled: true
    spec: |
      podPriorityThreshold: -10 
      resourceLimits:
        maxNodesTotal: 9
        cores:
          min: 6
          max: 24
        memory:
          min: 12
          max: 48
      scaleDown: 
        enabled: true 
        delayAfterAdd: 5m 
        delayAfterDelete: 3m 
        delayAfterFailure: 40s 
        unneededTime: 60s 

machineConfig: 
  enabled: true
  kubelet_gc_enabled: true
  kubelet_connectiontimeout_enabled: true

machineHealthCheck:
  enabled: false
  list: 
  - name: master
    type: master
    maxUnhealthy: 100%
    timeouts: 300s
  - name: a-infra
    type: infra
    maxUnhealthy: 40%
    timeouts: 300s
  - name: b-infra
    type: infra
    maxUnhealthy: 40%
    timeouts: 300s
  - name: c-infra
    type: infra
    maxUnhealthy: 40%
    timeouts: 300s
  - name: a-small
    type: worker
    maxUnhealthy: 40%
    timeouts: 300s
  # - name: b-small
  #   type: worker
  #   maxUnhealthy: 40%
  #   timeouts: 300s
  - name: c-small
    type: worker
    maxUnhealthy: 40%
    timeouts: 300s
  - name: a-big
    type: worker
    maxUnhealthy: 40%
    timeouts: 300s
  - name: b-big
    type: worker
    maxUnhealthy: 40%
    timeouts: 300s
  - name: c-big
    type: worker
    maxUnhealthy: 40%
    timeouts: 300s

machineAutoscaler: 
  enabled: true
  list: 
  - name: a-infra
    type: infra
    minReplicas: 1
    maxReplicas: 2
  - name: b-infra
    type: infra
    minReplicas: 1
    maxReplicas: 2
  - name: c-infra
    type: infra
    minReplicas: 1
    maxReplicas: 2
  - name: a-small
    type: worker
    minReplicas: 0
    maxReplicas: 3
  # - name: b-small
  #   type: worker
  #   minReplicas: 0
  #   maxReplicas: 3
  - name: c-small
    type: worker
    minReplicas: 0
    maxReplicas: 3
  - name: a-big
    type: worker
    minReplicas: 0
    maxReplicas: 2
  - name: b-big
    type: worker
    minReplicas: 0
    maxReplicas: 2
  - name: c-big
    type: worker
    minReplicas: 0
    maxReplicas: 2

machineSet: 
  enabled: false
  list:
  - name: a-infra
    az: a
    type: infra
    subnet_name: plateformedonnees-subnet-private1-eu-west-3a
    ami: ami-07b7248cf3c2b3190
    instanceType: "m5a.2xlarge" # 8cpu, 32Gi
    volumeSize: 120
    replicas: 1
  - name: b-infra
    az: b
    type: infra
    subnet_name: plateformedonnees-subnet-private2-eu-west-3b
    ami: ami-07b7248cf3c2b3190
    instanceType: "m5a.2xlarge"
    volumeSize: 120
    replicas: 1
  - name: c-infra
    az: c
    type: infra
    subnet_name: plateformedonnees-subnet-private3-eu-west-3c
    ami: ami-07b7248cf3c2b3190
    instanceType: "m5a.2xlarge"
    volumeSize: 120
    replicas: 1
  - name: a-small
    az: a
    type: worker
    subnet_name: plateformedonnees-subnet-private1-eu-west-3a
    ami: ami-07b7248cf3c2b3190
    instanceType: "c5a.xlarge" # 4cpu, 8Gi
    volumeSize: 100
    replicas: 0
  # - name: b-small
  #   az: b
  #   type: worker
  #   subnet_name: plateformedonnees-subnet-private2-eu-west-3b
  #   ami: ami-07b7248cf3c2b3190
  #   instanceType: "c5a.xlarge"
  #   volumeSize: 100
  #   replicas: 0
  - name: c-small
    az: c
    type: worker
    subnet_name: plateformedonnees-subnet-private3-eu-west-3c
    ami: ami-07b7248cf3c2b3190
    instanceType: "c5a.xlarge"
    volumeSize: 100
    replicas: 0
  - name: a-big
    az: a
    type: worker
    subnet_name: plateformedonnees-subnet-private1-eu-west-3a
    ami: ami-07b7248cf3c2b3190
    instanceType: "m5a.2xlarge"
    volumeSize: 100
    replicas: 0
  - name: b-big
    az: b
    type: worker
    subnet_name: plateformedonnees-subnet-private2-eu-west-3b
    ami: ami-07b7248cf3c2b3190
    instanceType: "m5a.2xlarge"
    volumeSize: 100
    replicas: 0
  - name: c-big
    az: c
    type: worker
    subnet_name: plateformedonnees-subnet-private3-eu-west-3c
    ami: ami-07b7248cf3c2b3190
    instanceType: "m5a.2xlarge"
    volumeSize: 100
    replicas: 0
