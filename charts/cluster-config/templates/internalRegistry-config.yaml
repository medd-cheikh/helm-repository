{{- if .Values.registryconfig.enabled -}}
---
apiVersion: imageregistry.operator.openshift.io/v1
kind: Config
metadata:
  name: cluster 
  labels:
    {{- include "cluster-config.labels" . | nindent 4 }}
    app.kubernetes.io/name: "{{- include "startx.appName" . -}}-{{- include "startx.appVersion" . -}}"
  annotations:
    {{- include "cluster-config.annotations" . | nindent 4 }}
spec:
  # httpSecret: d9a012ccd117b1e6616ceccb2c3bb66a5fed1b5e481623
  logging: 2
  managementState: Managed
  proxy: {}
  replicas: 3
  requests:
    read: {}
    write: {}
  {{- if .Values.registryconfig.s3Storage }}
  storage:
    s3:
      {{- if .Values.registryconfig.s3RegionEndpoint }}
      regionEndpoint: {{ .Values.registryconfig.s3RegionEndpoint | quote }}
      {{- end }}
      {{- if .Values.registryconfig.s3VirtualHostedStyle }}
      virtualHostedStyle: {{ .Values.registryconfig.s3VirtualHostedStyle | quote }}
      {{- end }}
      bucket: {{ .Values.registryconfig.s3Bucket | default "mybucketname" | quote }}
      region: {{ .Values.registryconfig.s3Region | default "us-east-1" | quote }}
  {{- end }}
  affinity:
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
      - podAffinityTerm:
          namespaces:
          - openshift-image-registry
          topologyKey: kubernetes.io/hostname
        weight: 100
  logLevel: Normal
  {{- if .Values.registryconfig.infra_enabled }}
  nodeSelector:
    node-role.kubernetes.io/infra: ""
  tolerations:
    - effect: NoSchedule 
      key: node-role.kubernetes.io/infra 
      operator: Exists
  {{- end }}
{{- end -}}
